var O=Object.defineProperty;var k=(r,e,o)=>e in r?O(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o;var g=(r,e,o)=>(k(r,typeof e!="symbol"?e+"":e,o),o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();const d=.2;class U{constructor(){g(this,"ctx");g(this,"width");g(this,"height");this.getCtx((e,o,s)=>{e.transform(1,0,0,-1,0,s),e.scale(d,d)}),this.reset()}getCtx(e){if(this.ctx&&this.width&&this.height){e(this.ctx,this.width,this.height);return}const o=document.getElementById("myCanvas");if(o){const s=o.getContext("2d"),{width:t,height:a}=o.getBoundingClientRect();s&&(this.ctx=s,this.width=t,this.height=a,e(s,t,a))}}reset(){this.getCtx(e=>{e.beginPath(),e.lineWidth=2,e.scale(5,5),this.drawRect(0,0,e.canvas.width,e.canvas.height,"#ad6242"),e.scale(d,d),e.font="60px Arial"})}drawLine(e,o,s,t,a=!1){this.getCtx(n=>{a&&n.setLineDash([5,3]),n.beginPath(),n.moveTo(e,o),n.lineTo(s,t),n.stroke(),n.closePath(),a&&n.setLineDash([])})}drawRect(e,o,s,t,a){this.getCtx(n=>{n.fillStyle=a,n.fillRect(e,o,s,t)})}drawVector(e,o,s,t,a=!1){const n=e+s*Math.cos(t),i=o+s*Math.sin(t);return this.drawLine(e,o,n,i,a),[n,i]}drawArrow(e,o,s,t,a=!1){const[n,i]=this.drawVector(e,o,s,t,a);return this.drawVector(n,i,s/5,t+3*Math.PI/4,a),this.drawVector(n,i,s/5,t-3*Math.PI/4,a),[n,i]}drawText(e,o,s){this.getCtx(t=>{t.save(),t.scale(1,-1),t.fillText(e,o,s*-1),t.restore()})}drawInfoVector(e,o,s,t,a,n=!1){this.getCtx(()=>{const[i,h]=this.drawArrow(e,o,s,t,n),w=i+s*Math.cos(t),y=h+s*Math.sin(t);this.drawText(a,w,y)})}drawShip(e){this.getCtx(o=>{o.fillStyle="#000",o.beginPath(),o.arc(e.x,e.y,50,0,2*Math.PI),o.stroke(),o.closePath();const s=120,t=e.hs>0?0:Math.PI;this.drawInfoVector(e.x,e.y,s,t,e.hs.toFixed(0),!0);const a=e.vs>0?Math.PI/2:-Math.PI/2;this.drawInfoVector(e.x,e.y,s,a,e.vs.toFixed(0),!0),this.drawInfoVector(e.x,e.y,(e.power/4+1.5)*s,Math.PI-e.rotate,e.power+""),this.drawText(`Liters of fuel: ${e.fuel.toFixed(0)}`,e.x-200,e.y+200)})}drawFailure(e){this.getCtx((o,s,t)=>{o.font="720px Arial",o.save(),o.scale(1,-1),o.textAlign="center",o.fillText(e,s/d/2,(t/d/2-360)*-1),o.restore(),o.font="60px Arial"})}drawGround(e){this.getCtx((o,s)=>{e.push([s/d,0],[0,0]);let[t]=e,a=new Path2D;a.moveTo(t[0],t[1]);for(let n=1;n<e.length;n++){const[i,h]=e[n];a.lineTo(i,h)}a.closePath(),o.fillStyle="#c1440e",o.fill(a,"evenodd"),o.stroke()})}}function Y(r){return console.log(r),[-20,3]}const v=[[0,1500],[1e3,2e3],[2e3,500],[3500,500],[5e3,1500],[6999,1e3]],R=[5e3,2500,-50,0,1e3,90,0],$=.5,L=16;let D=$;const I=document.querySelector("#ground");I&&(I.textContent=v.join(`
`),I.setAttribute("rows",v.length+""));const T=document.querySelector("#ship");T&&(T.value=R.join(", "));const S=document.querySelector("#simulationSpeed");S&&(S.value=($*100).toString(),S.oninput=function(){D=1-Number(this.value)/100});function u(r){const e=document.querySelector("#debug");if(e){const o=document.createElement("div");o.classList.add("list"),r.split(`
`).forEach(s=>{const t=document.createElement("div");o.append(t),t.textContent=s}),e.insertBefore(o,e.firstChild)}}const b=document.querySelector("#reset");b&&(b.onclick=function(){x&&clearTimeout(x),F=0,V=0,_()});const m=new U;function B(){m.drawGround(v)}let F=0,V=0,x;const H=3.711;function q(r,e){const o=Number((1e3*D/L).toFixed(0)),s=V++%o===0;let t="";function a(){t=`Iteration ${F++}:`,t+=`
  x:${r.x}, y:${r.y}, hs:${r.hs}, vs:${r.vs}, rotate:${r.rotate}, power:${r.power}, fuel:${r.fuel}`}s&&a(),x=setTimeout(()=>{m.reset(),B();const n=(r.rotate+90)/180*-Math.PI;if(m.drawShip({...r,rotate:n}),r.x<0||r.x>7e3||r.y<0||r.y>3e3){a(),u(t),u("flown away");return}let i,h;for(const[l,c]of e)if(r.x<l&&h!==void 0&&i!==void 0){const E=(c-h)/(l-i),N=h-E*i;if(E*r.x+N>r.y){a(),u(t),m.drawFailure("wasted"),u("crashed");return}else break}else i=l,h=c;let w=r.rotate,y,M,f=r.power;if(s){const[l,c]=Y(r);if(t+=`
  user out: ${l}, ${c}`,l>90||l<-90)throw new Error("Rotate value incorrect");if(c>4||c<0)throw new Error("Power value incorrect");w=Math.abs(l+90-(r.rotate+90))<=15?l:l>r.rotate?r.rotate+15:r.rotate-15,f=Math.abs(r.power-c)<=1?c:c>r.power?r.power+1:r.power-1,t+=`
  comp out: ${w}, ${f}`,r.fuel===0&&(f=0)}const C=(w+90)/180*Math.PI,P=r.hs+Math.cos(C)*f/o,A=r.vs+(Math.sin(C)*f-H)/o;y=r.x+P/o,M=r.y+A/o;const G={rotate:w,power:f,x:y,y:M,hs:P,vs:A,fuel:r.fuel-f/o};s&&u(t),requestAnimationFrame(()=>q(G,e))},L)}function _(){const r=document.querySelector("#debug");r&&(r.innerHTML="");const[e,o,s,t,a,n,i]=R;q({x:e,y:o,hs:s,vs:t,fuel:a,rotate:n,power:i},v)}_();
